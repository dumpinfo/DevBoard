//DMAVR-128的蜂鸣器发声示例程序
//编译环境 ICCAVR 7.16A
//系统时钟7.3728MHZ，设置熔丝位为外部高频石英晶体振荡，启动时间4.1ms
//作者：阿迪 www.avrgcc.com
//日期：2010.01.14
//***********************************************************************
//			包含文件
//***********************************************************************

#include <string.h>
#include <stdio.h>
#include <delay.h>
#include <iom128v.h>
//***********************************************************************
//			定义变量区
//			CH451各个功能命令值，根据需要写入
//***********************************************************************

#define uchar           unsigned char
#define uint            unsigned int

#define beep0             PORTD &= ~(1 << PD6)    		//蜂鸣器所在IO口PD6
#define beep1             PORTD |= (1 << PD6)
#define led8              PORTB                        //LED控制口PB

//*************************************************************************
//			初始化子程序
//*************************************************************************
void system_init()
{
  PORTD=0xff;                                       //PD设置为输出
  DDRD=0xff;
  
  PORTB=0xff;                                       //PB设置为输出
  DDRB=0xff;                                        //上拉电阻无效
}

uint left_shift(uchar dat,uchar count)              //左移
{
  dat=dat<<count;
}
//********************************************************************
//			主函数
//********************************************************************


void main(void)
{
  uint i; 
  uint  a,b,c,k,j;  
  system_init();  
  k=0x01;             								 //先给k初值00000001等待移位
  while(1)
  {
       for(i=8;i>0;i--)
       {     
        delay_nms(200);
        beep1;             							 //打开蜂鸣器
        delay_nms(300);    							 //让它响
        beep0;            							 //关闭蜂鸣器 
        a=k;              							 //把移完的值再送给j  
		c=~a;     
        led8=c;          							 //同时把值送到PB口点亮发二极管        
        a=left_shift(k,1);     						 //把k循环左移一位        
        k=a;             							 //把移完的值再送给k
      }
      k=0x01;
   }

}
